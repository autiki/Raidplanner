<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="1.2.2/modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http
://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.2.xsd">
	<header>
		<license>http://opensource.org/licenses/gpl-license.php GNU General Public License v2</license>
		
		<title lang="en">phpbb Calendar</title>
		
		<description lang="en"><![CDATA[A calendar MOD for phpBB to allow users to post events for public or private view within phpBB.

New features in 0.1.0:

* Recurring events - events will be occurrenceable with 12 different options:
1) A: Day [X] of [Month Name] every [Y] Year(s)
2) A: [Xth] [Weekday Name] of [Month Name] every [Y] Year(s)
3) A: [Xth] [Weekday Name] of full weeks in [Month Name] every [Y] Year(s)
4) A: [Xth from last] [Weekday Name] of [Month Name] every [Y] Year(s)
5) A: [Xth from last] [Weekday Name] of full weeks in [Month Name] every [Y] Year(s)
6) M: Day [X] of month every [Y] Month(s)
7) M: [Xth] [Weekday Name] of month every [Y] Month(s)
8) M: [Xth] [Weekday Name] of full weeks in month every [Y] Month(s)
9) M: [Xth from last] [Weekday Name] of month every [Y] Month(s)
10) M: [Xth from last] [Weekday Name] of full weeks in month every [Y] Month(s)
11) W: [Weekday Name] every [Y] Week(s)
12) D: Every [Y] Day(s)

The user gets to enter the frequency [Y] value, and the other value's in []'s are interpolated from the user's selected start date. 

There is a new user permission setting to determine which users have permission to create recurring events. 

Recurring events can be deleted individually, or all events of the recurring group can be deleted together. Recurring events can be edited individually (including start/end time settings, but not recurring event settings) or you can edit the whole group of events altogether. If you're editing the whole group of recurring events - you will not be able to edit any of the scheduling data, you'll only have access to the subject, body, invite list, and registration (rsvp) settings. 

When creating a recurring event you can specify the last day of the event group, or you can specify the recurring event as never ending. 

Recurring events are populated by a cron job, and you can edit how often the cron job runs in the ACP. You can also specify in the ACP how many days into the future you want to have populated in the calendar at a time.

* Event Registration - When creating new events, users have the option to enable attendance tracking which allows users to register for the event. The event creator can also specify whether forum members are allowed to bring guests to this event. When viewing the event, users are prompted to register for the event, and if guests are allowed they can specify how many people they are bringing to the event so the calendar can track the total headcount for the event. Permissions can be used to control who has permission to create events with attendance tracking, and who is able to see what information gathered from users registering for the event. Users are allowed to leave comments with their "yes", "no", or"maybe" reply, and the comments support smilies, bbcode, etc.

* Ability to invite multiple groups to an event

* Custom date/time formatting controlled in calendar ACP - this overwrites the user's preferred date/time format, so you can display just the time in hours where it makes sense (like in the week view) or the whole date+time (like in the display event)

* Ability to display events only on their start date - obviously the day view is a graphical display of all things going on, and events will display in the day view even if not on the start date with this setting turned on. However it's great for things like a week view with an event that starts at 10pm and ends at 2am the next day, because it will only display on the first day.

* Ability to display a list of upcoming events for the next X days 

* Detailed display for calendar on who is online page 

* New permission option to invite groups you're not a member of - if this is turned on, you'll be able to create events for groups you don't belong to, but the author of the event will always be able to see their own events - even if they don't belong to the invite list.

* Detailed permissions for ability to create private, group, or public events - now you can give some users the power to create public events, and others only permission to create private events, or whatever combination makes sense for your forum.

* Utility in ACP to move all events +/- one hour (helps when changing forum's dst setting). When you create an event it's stored in an absolute time, and if the forum (and/or users) change their dst settings they may suddenly see all the events appear off by one hour, now there's a utility to move ALL events in the calendar forward or back by one hour to help correct things when you change your DST.

* Ability to filter the calendar for events of a specific type - currently there's no UI for this, it's simply a matter of adding a calEType argument to the URL. The user who requested this feature sounded like they would create links to "different" calendars on their forum, where each calendar only displayed events of the specified type.

* Optional UCP module that displays upcoming events (that the user has registered for) for the next X days.

* Optional UCP module that displays upcoming events (that the user has created) for the next X days.

* Ability to "Watch" the calendar - users can elect to watch the calendar for email notifications when new events are created (that they are invited to).  The user is sent one notification when a new event is created, but no new notifications for new events are sent until they re-visit the calendar (much like how notifications are sent for forums you "subscribe" to).

* Ability to "Watch" a specific event for updates and/or replies.  Users can elect to watch a specific event for update notifications whenever the event creator updates the event information or other users update thier reply (registration) for the event.  Note if the user doesn't have permission to view detailed event replies - they will not recieve the email notifications when other users reply to an event, but they will still recieve the email notifications when the event poster updates the event information.
]]></description>
		
		<author-notes lang="en"><![CDATA[As with any mod installation, be sure to save a backup copy of your database and your files.  This is a complicated mod!  If you miss a step, restoring your backup database and files is a fast way to get your board back up and running.  Often by forcing yourself to go through the entire installation again you will find the step you missed and fix the problems yourself.
				
				---------------------------------------------------
								
				After editing the SQL database and uploading the files you must:
				
				1) Open the prosilver.xml and follow those instructions to install the required style changes. If you don't follow these, your calendar will not have a user interface.
				
				2) Install the calendar modules in the ACP (and enable them), purge your cache in the ACP, set up the calendar permissions (make sure to give yourself permission to administrate the calendar) configure the calendar in the new ACP calendar modules.
				
				---------------------------------------------------
				
				Troubleshooting and tips to avoid problems:
				
				1) If you have problems accessing the ACP modules after installation, be sure you purge your cache in the ACP, and then make sure you have given yourself calendar admin privileges.
				
				2) The SQL commands provided assume you're using MySQL 41 for your database... if you're using something else like: Firebird, Mssql, MySQL40, Oracle, Postgres, or Sqlite you may have some difficulties (especially when declaring variables that hold foreign characters.  See this post for more details: 
				
				http://www.phpbb.com/community/viewtopic.php?f=70&t=666195&st=0&sk=t&sd=a&start=225#p3824905
				
				One kind user posted their changes required for 0.0.8 MSSQL 9 (2005) you will find them in the contrib folder.  If you port the SQL commands to any other database type, please post them so we can add them to the contrib folder for the next release.
				
				3) The sql commands assume you are using phpbb_ as your table prefix.  If your table prefix is not phpbb_, you must edit the sql commands to match your table prefix before executing the sql commands.  To find your table prefix open your root/config.php file and look for something like: $table_prefix = 'phpbb_';
				For example, phpbb3_ is commonly used as the table prefix on a forum that was converted from phpbb2 to phpbb3.  In this case you must find phpbb_ and replace it with phpbb3_ before running the sql commands.

				4) If you have any problems with your permissions please run the following command in phpMyAdmin: select * from phpbb_acl_options where auth_option like '%calendar%';  If you see anything listed twice that's the source of your problem - you must remove all duplicate entries from that table and start over with setting up your permissions in the ACP.  These duplicate entries were caused by running the SQL command on the acl_options table more then once.  Also if you don't purge your cache after installing the modules, the permissions you attempt to set may not save properly.  If you don't have duplicate entries in your acl_options table, purge your cache and try to reset your permissions... hopefully this time it will save the changes you're telling it to save.
				
				5) If your calendar looks dark blue everywhere - instead of what you see in the demo, you haven't refreshed your style properly.  Enter the ACP and go to the "Styles" tab and select "Templates" from the list of style components on the left.  Find your style name in the list of installed templates, and click the link to "Refresh" your style's template.  Confirm that "Yes" you really eant to clear the cached version of your template.  Now select "Themes" from the list of style components on the left.  Find your style name in the list of installed themes and click on the link to "Refresh" your style's theme.  Confirm that "Yes" you really want to clear the cached version of your theme.  Finally select "Imagesets" from the list of style componenets, and refresh your imageset.  Now return to the general tab and click the "Run now" button next to where it says "Purge the cache".  Now return to your calendar and refresh the page.  I've seen internet explorer store stale copies of the calendar in my temporary interenet files before, so if all else fails, close all browser windows except for one, go to Tools->Internet Options, and on the "General" tab choose "Delete Files" to delete all of your cached web pages on your computer.  Now return to the ACP (don't view the calendar yet) and refresh all the parts of the style and purge the cache again.  Now return to the calendar, and things should look better.
				
				6) If you don't see some of the icons in your calendar like you see in the demo, first make sure you've tried steps 4 and 5 above.  Bad permissions will prevent icons from showing if you don't have permission to use them.  Failing to refresh all the parts of your style may also prevent icon display.  Here are some tips:
				a) If you're not using english, be sure you uploaded the icons into the appropriate folder for your language.  They are language specific, as the numerals displayed on the calendar icons are different in english and Chinese character sets.
				b) If you can see all of the icons except for the star, then you probably don't really have permission to create new events - go back to troubleshooting step 4 and then go into your ACP->Permissions and select "View user-based permissions" at the bottom left.  Now select your username from the list of users and click "View permissions".  Click on the calendar tab and if you don't see a green background under the yes columns for "Can create [group/private/public] events" that's your problem.  To see how your permission was calculated click on the circle with an arrow just to the left of where it says "Can create [group/private/public] events".  That will open a popup window which shows you exactly what permission settings you're using from what group - so you can figure out what you need to change.
				
				7) Be careful when hand editing any of the files.  You must use a proper text editor - especially one that supports UTF-8 without bom formatting for the language files.  If you have a simple white space before the starting <?php in a file you may see strange errors, so the white space and character encoding you get from your text editing program are very important.  I believe notepad is a common cause of problems like these.  Textpad is an inexpensive editor that you may find useful: http://www.textpad.com/  I've also heard that there is a free editor called notepad++ (not to be confused with notepad) that will work well if you specify the proper settings when saving the file.
								
				8) Before installing this mod (at the very least) you MUST read all posts in the thread pertaining to this latest release.  For example if the current release is 0.0.5, please search the thread for the first post with 0.0.5 in the subject, and read all of the posts through to the end of the thread.  Why?  If any bugs were reported in this release, I will post the fix as soon as it's available, so save yourself some trouble and look for bug fixes (if there are any) before you install this mod.
				
				9) If you've finished reading all of these troubleshooting pages and are still lost, try searching for the answer on phpbb.com/community.  If you return to the calendar topic here: http://www.phpbb.com/community/viewtopic.php?f=70&t=666195&st=0&sk=t&sd=a be warned that the search box that says "Search this topic..." does NOT do what it implies.  It will return everything outside of this topic making it almost impossible to find what you're looking for.
				
				Here's a better way to find what your looking for.  Go to the "Advanced Search" page here: http://www.phpbb.com/community/search.php  Since "calendar" and "alightner" are in the subject of virtually every post in this thread, be sure to enter the following in your "Search for keywords:" calendar alightner whatever_you_are_looking_for.  Also make sure to select "Search for all terms or use query as entered".  That should help you find what you need.
				
				
				---------------------------------------------------
				
				Other notes:
				 
				This mod is NOT recommended for beginners, because it is still in development and may have many updates released.
									
				Before posting any enhancement requests in the mod thread, please read the entire post thread - that means you'll have to read at least 175 pages, but I've had to read them all too (many times) so laziness is no excuse.  It's likely someone has requested the same thing before, so please check before making a new request... it's polite and I appreciate it :) Also if you post an enhancement request, and I don't respond - it does NOT mean that I didn't read your post.  It means I'm considering it.  I won't commit to new functionality if I don't know how long it will take to implement, so if you get a fast response, it's often me saying "No".  If you want me to take your request seriously - you should give me time to think it over, repeating your question makes you sound impatient and disrespectful... Simple manners will get you far.
				
				]]>
		</author-notes>
		
		<author-group>
			<author>
				<realname>E. Ford</realname>
				<username>alightner</username>
				<homepage>http://www.phpbbcalendarmod.com</homepage>
      		<contributions-group>
      		  <contributions status="current" position="Developer"/>
      		</contributions-group>			 				
			</author>
		</author-group>
		
		<mod-version>0.1.0</mod-version>
		
		<installation>
			<level>intermediate</level>
			<time>1800</time>
			<target-version>3.0.5</target-version>
		</installation>

				<history>
					<entry>
						<date>2008-01-06</date>
						<rev-version>
							<major>0</major>
							<minor>0</minor>
							<revision>0</revision>
							<release>a</release>
						</rev-version>
						<changelog lang="en">
							<change>Fixed bugs in calendarpost.php:
1) defined error variable
2) added check for NULL mode to prevent triggering USER_CANNOT__EVENT error.
3) removed event_level initialization on new events.</change>

<change>Fixed bugs in includes\functions_calendar.php:
1) added check for invalid event in calendar_display_event.
2) removed check for sizeof($error) in calendar_display_event.
3) changed $poster_data['username_colour'] to $poster_data['user_colour']
4) changed if( $month_names[1] !== "January" ) to if( count($month_names) == 0 )
5) add $date as global variable in handle_event_delete.
6) fixed first sql query inside handle_event_delete.

Added 'INVALID_EVENT' string to language\en\calendar.php.</change>
						</changelog>
					</entry>
					<entry>
						<date>2008-01-07</date>
						<rev-version>
							<major>0</major>
							<minor>0</minor>
							<revision>1</revision>
							<release></release>
						</rev-version>
						<changelog lang="en">
							<change>Fixed bug when editing from all day event to timed event in calendarpost.php</change>
						</changelog>
					</entry>
					<entry>
						<date>2008-01-09</date>
						<rev-version>
							<major>0</major>
							<minor>0</minor>
							<revision>2</revision>
							<release></release>
						</rev-version>
						<changelog lang="en">
							<change>Allow foreign characters in event_types names (includes\acp\acp_calendar.php)</change>
							<change>Fix bug in which only one birthday is displayed per day (includes\functions_calendar.php)</change>
							<change>Fix translation bug with month selection pulldown menu (calendarpost.php)</change>
						</changelog>
					</entry>
					<entry>
						<date>2008-01-13</date>
						<rev-version>
							<major>0</major>
							<minor>0</minor>
							<revision>3</revision>
							<release></release>
						</rev-version>
						<changelog lang="en">
							<change>Update SQL commands</change>
							<change>Fix pass by reference bug (includes\functions_calendar.php)</change>
							<change>Fix pass by reference bug (calendarpost.php)</change>
						</changelog>
					</entry>
					<entry>
						<date>2008-01-25</date>
						<rev-version>
							<major>0</major>
							<minor>0</minor>
							<revision>4</revision>
							<release></release>
						</rev-version>
						<changelog lang="en">
							<change>Update SQL commands for the phpbb_calendar_config table (added support for 12/24 hour display and truncated names)</change>
							<change>Make things xhtml compliant (special thanks to ncc50446 for cleaning this up) (adm/style/acp_calendar.html, adm/style/acp_calendar_event_types.html, includes/acp/acp_calendar.php, includes/functions_calendar.php, styles/prosilver/template/calendar.html, styles/prosilver/template/calendar_next_events_on_index.html, styles/prosilver/template/calendar_post_body.html, styles/prosilver/template/calendar_post_editor.html, styles/prosilver/template/calendar_post_preview.html, styles/prosilver/template/calendar_view_day.html, styles/prosilver/template/calendar_view_event.html, styles/prosilver/template/calendar_week_on_index.html, calendarpost.php)</change>
							<change>Add support for 12 hour vs 24 hour display. (adm/style/acp_calendar.html, includes/acp/acp_calendar.php, includes/functions_calendar.php, language/en/mods/calendar.php, language/en/calendar.php, language/en/calendarpost.php, styles/prosilver/template/calendar_view_day.html, calendarpost.php)</change>
							<change>Add support for truncating the event subject in the calendar display. (adm/style/acp_calendar.html, includes/acp/acp_calendar.php, includes/functions_calendar.php, language/en/mods/calendar.php)</change>
							<change>Fix DST bug. (includes/functions_calendar.php, calendarpost.php)</change>
							<change>Fix bug where late at night the "next week display on index" showed the previous week (includes/functions_calendar.php)</change>
							<change>Fix bug where some events didn't show up on the "upcoming events list on index" the day of the event. (includes/functions_calendar.php)</change>
							<change>Fix bug where previous years weren't available on the view date pulldown menu after jumping forward a few years (includes/functions_calendar.php)</change>
							<change>Fixed bug where the next events on index caused the colors to change in the online list and statistics sections (includes/functions_calendar.php)</change>
						</changelog>
					</entry>
					<entry>
						<date>2008-02-15</date>
						<rev-version>
							<major>0</major>
							<minor>0</minor>
							<revision>5</revision>
							<release></release>
						</rev-version>
						<changelog lang="en">
							<change>Fix bugs in xhtml changes from 0.0.4 - things stopped working in firefox (styles/prosilver/template/calendar_post_body.html, styles/prosilver/template/calendar_post_editor.html, calendarpost.php, adm/style/acp_calendar.html, adm/style/acp_calendar_event_types.html)</change>
							<change>Add a few more xhtml compliant changes (adm/style/acp_calendar_event_types.html)</change>
							<change>Fix another DST bug in the week and month views. (includes/functions_calendar.php)</change>
							<change>Fixed incompatability issue with Arcade mod.  Renamed generate_smilies function to generate_calendar_smilies (calendarpost.php, includes/functions_calendar.php)</change>
							<change>Fix style issue with location of submit button during event posting (styles/prosilver/template/calendar_post_body.html, styles/prosilver/template/calendar_post_editor.html)</change>
							<change>Fix tranlation bug with calendar title on view event page (includes/functions_calendar.php, styles/prosilver/template/calendar_view_event.html)</change>
							<change>Fix uninitialized variable $event_counter (includes/functions_calendar.php)</change>
							<change>Allow calendar header date to be localized to different formats. (language/en/calendar.php, includes/functions_calendar.php)</change>
							<change>Fix partial icon display bug. Add  text-align: left; in hand edits for buttons.css (styles/prosilver/theme/buttons.css)</change>
							<change>Fix encoding of special html characters in event subject (calendarpost.php)</change>
							<change>Fix session logout (when cookies disabled) when entering calendar (includes/functions.php, styles/prosilver/template/overall_header.html)</change>
							<change>Add "..." to end of truncated subject strings (includes/functions_calendar.php)</change>
						</changelog>
					</entry>
					<entry>
						<date>2008-02-24</date>
						<rev-version>
							<major>0</major>
							<minor>0</minor>
							<revision>6</revision>
							<release></release>
						</rev-version>
						<changelog lang="en">
							<change>Add support for Auto-pruning events (SQL insert new entries in calendar_config table, cron.php, adm/style/acp_calendar.html, includes/functions.php, includes/functions_calendar.php, includes/acp/acp_calendar.php, language/en/mods/calendar.php)</change>
							<change>Redesigned style to look more pro-silver like and added more comments to changed style files. (includes/functions_calendar.php, styles/prosilver/template/calendar.html, styles/prosilver/template/calendar_view_day.html, styles/prosilver/template/calendar_view_week_on_index.html, styles/prosilver/theme/buttons.css, styles/prosilver/theme/colours.css)</change>
							<change>Fixed bug where event subjects were displaying censored words in the calendar (includes/functions_calendar.php)</change>
							<change>Add Mod Version Check support. (adm/mods/phpbb_calendar_version.php)</change>
							<change>Hide birthdays in calendar, unless user has permission to view profiles (includes/functions_calendar.php)</change>
							<change>When errors are encountered during event creation, store re-use the input date/time info - don't force the user to start from scratch (calendarpost.php)</change>
						</changelog>
					</entry>
					<entry>
						<date>2008-03-02</date>
						<rev-version>
							<major>0</major>
							<minor>0</minor>
							<revision>7</revision>
							<release></release>
						</rev-version>
						<changelog lang="en">
							<change>Fix uninitialized variable subject_limit (includes/functions_calendar.php)</change>
							<change>There were several bugs related to timezone and DST settings of the server hosting the forum.  In particular forums hosted in the southern hemisphere were seeing the most problems because their DST schedule is opposite GMT's DST schedule. Hopefully this is the last of the timezone/DST bug fixes ;) (calendarpost.php, includes/functions_calendar.php)</change>
							<change>Update check mod version file (adm/mods/phpbb_calendar_version.php)</change>
						</changelog>
					</entry>
					<entry>
						<date>2008-07-03</date>
						<rev-version>
							<major>0</major>
							<minor>0</minor>
							<revision>8</revision>
							<release></release>
						</rev-version>
						<changelog lang="en">
							<change>Update server name and version number (adm/mods/phpbb_calendar_version.php)</change>
							<change>Add option to allow everyday users to see hidden groups on invite list (adm/style/acp_calendar.html, includes/acp/acp_calendar.php, includes/functions_calendar.php, language/en/mods/calendar.php)</change>
							<change>Remove bogus warning when deleting an event type that was not referenced by any events (adm/style/acp_calendar_event_types.html, includes/acp/acp_calendar.php)</change>
							<change>Added color swatch to edit event type in ACP (adm/style/acp_calendar_event_types.html, includes/acp/acp_calendar.php)</change>
							<change>Correct calls to request_var with integer type values (includes/acp/acp_calendar.php, includes/functions_calendar.php, calendarpost.php)</change>
							<change>Remove alternate cron text - firefox bug unrelated to this mod, but many users complained about it so the fix is here if you want it (includes/functions.php)</change>
							<change>Display full event subject text on mouseover tooltip (includes/functions_calendar.php, styles/prosilver/template/calendar.html, styles/prosilver/template/calendar_next_events_on_index.html, styles/prosilver/template/calendar_view_day.html, styles/prosilver/template/calendar_week_on_index.html)</change>
							<change>Relocate the calendar on the index page (styles/prosilver/template/index_body.html)</change>
							<change>Prevent display of invalid days like February 31st - even if the user selected that option from the pulldown menu on purpose (includes/functions_calendar.php)</change>
							<change>Fix bug with displaying extra smilies when posting events (includes/functions_calendar.php)</change>
							<change>Remove ALL_DAY_STARTING - no longer used (language/en/calendar.php, language/en/calendarpost.php)</change>
							<change>On new event confirmation page, add link to view the newly created event (calendarpost.php)</change>
						</changelog>
					</entry>
					<entry>
						<date>2009-07-24</date>
						<rev-version>
							<major>0</major>
							<minor>1</minor>
							<revision>0</revision>
							<release></release>
						</rev-version>
						<changelog lang="en">
							<change>Added so many new features, it's easiest to list the changed files separate from the list of changed functionality so here goes... New/Edited files in 0.1.0: adm/mods/phpbb_calendar_version.php, adm/style/acp_calendar.html, includes/acp/info/acp_calendar.php, includes/acp/acp_calendar.php, includes/acp/acp_language.php,  includes/acp/acp_styles.php, includes/ucp/info/ucp_main.php, includes/ucp/ucp_main.php, includes/constants.php, includes/functions.php, includes/functions_calendar.php, language/en/acp/permissions_calendar.php, language/en/acp/styles.php, language/en/email/calendar_new_event.txt, language/en/email/calendar_updated_event.txt, language/en/email/calendar_updated_reply.txt, language/en/mods/calendar.php, language/en/calendar.php, language/en/calendarpost.php, language/en/common.php, language/en/ucp.php, styles/prosilver/imageset/en/icon_calendar_delete_all.gif, styles/prosilver/imageset/en/icon_calendar_edit_all.gif, styles/prosilver/imageset/en/imageset.cfg, styles/prosilver/template/calendar_next_events_for_x_days.html, styles/prosilver/template/calendar_next_events_on_index.html, styles/prosilver/template/calendar_post_editor.html, styles/prosilver/template/calendar_post_preview.html, styles/prosilver/template/calendar_view_event.html, styles/prosilver/template/overall_header.html, styles/prosilver/template/sorttable.js, styles/prosilver/template/ucp_main_calendar_myevents.html, styles/prosilver/template/ucp_main_calendar_registration.html, styles/prosilver/theme/buttons.css, styles/prosilver/theme/colours.css, calendar.php, calendarpost.php, cron.php, viewonline.php
							</change>
							<change>Add Recurring events</change>
							<change>Add Event Registration</change>
							<change>Add Ability to invite multiple groups to an event</change>
							<change>Add Custom date/time formatting controlled in calendar ACP</change>
							<change>Add Ability to display events only on their start date</change>
							<change>Add Ability to display a list of upcoming events for the next X days</change>
							<change>Add Ability to display a list of upcoming events (that the user has registered for) for the next X days</change>
							<change>Add Detailed display for calendar on who is online page</change>
							<change>Add New permission option to invite groups you're not a member of</change>
							<change>Add Detailed permissions for ability to create private, group, or public events</change>
							<change>Add Utility in ACP to move all events +/- one hour (helps when changing forum's dst setting).</change>
							<change>Add Ability to filter the calendar for events of a specific type</change>
							<change>Add UCP module to "Manage my events"</change>
							<change>Add UCP module to "Manage event registration"</change>
							<change>Add Ability to "watch" the calendar</change>
							<change>Add Ability to "watch" specific events</change>
							<change>Fix end of year bug (phpversion specific) use Y not o!</change>
							<change>Moved public events to default position</change>
							<change>Fix bug with hidden groups</change>
							<change>Provide contrib file to clean up birthdays without leading whitespace</change>
						</changelog>
					</entry>
				</history>

		<link-group>
			<link type="parent" href="../index.xml" lang="en">Main install file</link>
			<link type="template" href="prosilver.xml" lang="en">Prosilver</link>
			<link type="contrib" href="prosilver_upgrade_from_0_0_8.xml" lang="en">Upgrade Prosilver from 0.0.8</link>
			<link type="contrib" href="../contrib/subsilver_readme.txt" lang="en">Information about Subsilver</link>
			<link type="contrib" href="../contrib/cleanup_birthdays_readme.txt" lang="en">Information about birthdays converted from phpbb2</link>
			<link type="contrib" href="../contrib/MSSQL_readme.txt" lang="en">Information MSSQL users</link>
			<link type="contrib" href="../contrib/MySQL40_readme.txt" lang="en">Information MySQL40 users</link>
			<link type="contrib" href="../contrib/Postgres_readme.txt" lang="en">Information Postgres users</link>
			<link type="contrib" href="../contrib/sorttable_readme.txt" lang="en">Information about a sort table addin for event registration.</link>
			<link type="contrib" href="../contrib/us_holidays__readme.txt" lang="en">Information about installing US holidays in your calendar.</link>
			<link type="template-lang" href="../contrib/zh_cmn_hant/zh_cmn_hant.xml" lang="zh_cmn_hant">Chinese (zh_cmn_hant) translation from wang5555</link>
			<link type="template-lang" href="../contrib/de/install_de.xml" lang="de">German (de) translation from passat3233</link>
		</link-group>
	</header>
	
	<action-group>
		<sql><![CDATA[/* WARNING: do NOT execute the SQL commands on the phpbb_acl_options table more 
than once.  Executing this command more than once will add duplicate entries to the table 
breaking your current permissions and causing the calendar to malfunction */

INSERT INTO phpbb_acl_options (auth_option, is_global, is_local, founder_only) VALUES ('u_calendar_create_public_events', 1, 0, 0),
('u_calendar_create_private_events', 1, 0, 0),
('u_calendar_nonmember_groups', 1, 0, 0),
('u_calendar_track_rsvps', 1, 0, 0),
('u_calendar_allow_guests', 1, 0, 0),
('u_calendar_view_headcount', 1, 0, 0),
('u_calendar_view_detailed_rsvps', 1, 0, 0),
('u_calendar_create_recurring_events', 1, 0, 0),
('m_calendar_edit_other_users_rsvps', 1, 0, 0);

UPDATE phpbb_acl_options SET auth_option = 'u_calendar_create_group_events' where auth_option = 'u_calendar_create_events';


INSERT INTO `phpbb_calendar_config` (`config_name`, `config_value`) VALUES 
('time_format','h:i a'),
('date_format','M d, Y'),
('date_time_format','M d, Y h:i a'),
('disp_events_only_on_start','0'),
('populate_frequency','86400'),
('last_populate','0'),
('populate_limit','2592000');


ALTER TABLE `phpbb_calendar_events` CHANGE `event_id` `event_id` mediumint(8) unsigned NOT NULL auto_increment;

ALTER TABLE `phpbb_calendar_events` 
 ADD COLUMN `group_id_list` varchar(255) character set utf8 collate utf8_unicode_ci NOT NULL default ',' AFTER `group_id`,
 ADD COLUMN `track_rsvps` TINYINT(1) UNSIGNED NOT NULL DEFAULT 0 AFTER `bbcode_uid`,
 ADD COLUMN `allow_guests` TINYINT(1) UNSIGNED NOT NULL DEFAULT 0 AFTER `track_rsvps`,
 ADD COLUMN `rsvp_yes` MEDIUMINT(8) UNSIGNED NOT NULL DEFAULT 0 AFTER `allow_guests`,
 ADD COLUMN `rsvp_no` MEDIUMINT(8) UNSIGNED NOT NULL DEFAULT 0 AFTER `rsvp_yes`,
 ADD COLUMN `rsvp_maybe` MEDIUMINT(8) UNSIGNED NOT NULL DEFAULT 0 AFTER `rsvp_no`,
 ADD COLUMN `recurr_id` MEDIUMINT(8) UNSIGNED NOT NULL DEFAULT 0 AFTER `rsvp_maybe`;


CREATE TABLE IF NOT EXISTS `phpbb_calendar_recurring_events` (
  `recurr_id` mediumint(8) unsigned NOT NULL auto_increment,
  `etype_id` tinyint(4) NOT NULL,
  `frequency` tinyint(4) NOT NULL default '1',
  `frequency_type` tinyint(4) NOT NULL default '0',
  `first_occ_time` bigint(20) unsigned NOT NULL,
  `final_occ_time` bigint(20) unsigned NOT NULL,
  `event_all_day` tinyint(2) NOT NULL default '0',
  `event_duration` bigint(20) unsigned NOT NULL,
  `week_index` tinyint(2) NOT NULL default '0',
  `first_day_of_week` TINYINT(1) UNSIGNED NOT NULL DEFAULT 0,
  `last_calc_time` bigint(20) unsigned NOT NULL,
  `next_calc_time` bigint(20) unsigned NOT NULL,
  `event_subject` varchar(255) character set utf8 collate utf8_unicode_ci NOT NULL default '',
  `event_body` longblob NOT NULL,
  `poster_id` mediumint(8) unsigned NOT NULL default '0',
  `poster_timezone` decimal(5,2) NOT NULL default '0.00',
  `poster_dst` tinyint(1) unsigned NOT NULL default '0',
  `event_access_level` tinyint(1) NOT NULL default '0',
  `group_id` mediumint(8) unsigned NOT NULL default '0',
  `group_id_list` varchar(255) character set utf8 collate utf8_unicode_ci NOT NULL default ',',
  `enable_bbcode` tinyint(1) unsigned NOT NULL default '1',
  `enable_smilies` tinyint(1) unsigned NOT NULL default '1',
  `enable_magic_url` tinyint(1) unsigned NOT NULL default '1',
  `bbcode_bitfield` varchar(255) character set utf8 collate utf8_bin NOT NULL default '',
  `bbcode_uid` varchar(8) character set utf8 collate utf8_bin NOT NULL,
  `track_rsvps` tinyint(1) unsigned NOT NULL default '0',
  `allow_guests` tinyint(1) unsigned NOT NULL default '0',
  PRIMARY KEY  (`recurr_id`)
);

CREATE TABLE IF NOT EXISTS `phpbb_calendar_rsvps` (
  `rsvp_id` mediumint(8) unsigned NOT NULL auto_increment,
  `event_id` mediumint(8) unsigned NOT NULL default '0',
  `poster_id` mediumint(8) unsigned NOT NULL default '0',
  `poster_name` varchar(255) collate utf8_bin NOT NULL default '',
  `poster_colour` varchar(6) collate utf8_bin NOT NULL default '',
  `poster_ip` varchar(40) collate utf8_bin NOT NULL default '',
  `post_time` int(11) unsigned NOT NULL default '0',
  `rsvp_val` tinyint(1) unsigned NOT NULL default '0',
  `rsvp_count` smallint(4) unsigned NOT NULL default '1',
  `rsvp_detail` mediumtext collate utf8_bin NOT NULL,
  `bbcode_bitfield` varchar(255) collate utf8_bin NOT NULL default '',
  `bbcode_uid` varchar(8) collate utf8_bin NOT NULL,
  `bbcode_options` tinyint(1) unsigned NOT NULL default '7',
  PRIMARY KEY (`rsvp_id`),
  KEY `event_id` (`event_id`),
  KEY `poster_id` (`poster_id`),
  KEY `eid_post_time` (`event_id`,`post_time`)
);

CREATE TABLE IF NOT EXISTS `phpbb_calendar_events_watch` (
  `event_id` mediumint(8) unsigned NOT NULL default '0',
  `user_id` mediumint(8) unsigned NOT NULL default '0',
  `notify_status` tinyint(1) unsigned NOT NULL default '0',
  `track_replies` tinyint(1) unsigned NOT NULL default '0',
  KEY `event_id` (`event_id`),
  KEY `user_id` (`user_id`),
  KEY `notify_stat` (`notify_status`)
);

CREATE TABLE IF NOT EXISTS `phpbb_calendar_watch` (
  `user_id` mediumint(8) unsigned NOT NULL default '0',
  `notify_status` tinyint(1) unsigned NOT NULL default '0',
  KEY `user_id` (`user_id`),
  KEY `notify_stat` (`notify_status`)
);
]]></sql>

		<copy>
			<file from="root/adm/mods/phpbb_calendar_version.php" to="adm/mods/phpbb_calendar_version.php" />
			<file from="root/adm/style/acp_calendar.html" to="adm/style/acp_calendar.html" />
			<file from="root/adm/style/acp_calendar_event_types.html" to="adm/style/acp_calendar_event_types.html" />
			<file from="root/includes/acp/info/acp_calendar.php" to="includes/acp/info/acp_calendar.php" />
			<file from="root/includes/acp/acp_calendar.php" to="includes/acp/acp_calendar.php" />
			<file from="root/includes/functions_calendar.php" to="includes/functions_calendar.php" />
			<file from="root/language/en/acp/permissions_calendar.php" to="language/en/acp/permissions_calendar.php" />
			<file from="root/language/en/email/calendar_new_event.txt" to="language/en/email/calendar_new_event.txt" />
			<file from="root/language/en/email/calendar_updated_event.txt" to="language/en/email/calendar_updated_event.txt" />
			<file from="root/language/en/email/calendar_updated_reply.txt" to="language/en/email/calendar_updated_reply.txt" />
			<file from="root/language/en/mods/calendar.php" to="language/en/mods/calendar.php" />
			<file from="root/language/en/calendar.php" to="language/en/calendar.php" />
			<file from="root/language/en/calendarpost.php" to="language/en/calendarpost.php" />
			<file from="root/calendar.php" to="calendar.php" />
			<file from="root/calendarpost.php" to="calendarpost.php" />

		</copy>
		<open src="language/en/acp/styles.php">
			<edit>
				<comment lang="en"><![CDATA[Define recurring event icons for prosilver style]]></comment>
				<find><![CDATA['IMG_ICON_POST_EDIT'			=> 'Edit post',]]></find>
				<action type="after-add"><![CDATA[	'IMG_ICON_CALENDAR_EDIT_ALL'	=> 'Edit all posts',
	'IMG_ICON_CALENDAR_DELETE_ALL'	=> 'Delete all posts',]]></action>
			</edit>
		</open>
		<open src="language/en/common.php">
			<edit>
				<comment lang="en"><![CDATA[Define Calendar view online strings]]></comment>
				<find><![CDATA['VIEWED'					=> 'Viewed',
]]></find>
				<action type="after-add"><![CDATA[	'VIEWING_CALENDAR'			=> 'Viewing calendar',
	'VIEWING_CALENDAR_DAY'		=> 'Viewing calendar day',
	'VIEWING_CALENDAR_EVENT'	=> 'Viewing calendar event',
	'VIEWING_CALENDAR_MONTH'	=> 'Viewing calendar month',
	'VIEWING_CALENDAR_WEEK'		=> 'Viewing calendar week',
	'EDITING_CALENDAR_EVENT'	=> 'Editing calendar event',
	'CREATING_CALENDAR_EVENT'	=> 'Creating calendar event',

]]></action>
			</edit>
		</open>
		<open src="language/en/ucp.php">
			<edit>
				<comment lang="en"><![CDATA[Define Calendar UCP strings]]></comment>
				<find><![CDATA['DISABLE_CENSORS'			=> 'Enable word censoring',
]]></find>
				<action type="after-add"><![CDATA[	'DISPLAY_EVENTS_DAYCOUNT'	=> 'How many days into the future do you want to display?',
]]></action>
			</edit>
			<edit>
				<comment lang="en"><![CDATA[Define Calendar UCP module name strings]]></comment>
				<find><![CDATA['UCP_MAIN_ATTACHMENTS'		=> 'Manage attachments',]]></find>
				<action type="after-add"><![CDATA[	'UCP_MAIN_CALENDAR_MYEVENTS'	=> 'Manage my events',
	'UCP_MAIN_CALENDAR_REGISTRATION'=> 'Manage event registration',
]]></action>
			</edit>
		</open>
		<open src="includes/acp/acp_language.php">
			<edit>
				<comment lang="en"><![CDATA[Define calendar icons for prosilver style]]></comment>
				<find>'icon_back_top', 'icon_contact_aim', 'icon_contact_email',</find>
				<inline-edit>
					<inline-find><![CDATA['icon_post_edit',]]></inline-find>
					<inline-action type="after-add"><![CDATA[ 'icon_calendar_edit_all', 'icon_calendar_delete_all',]]></inline-action>
				</inline-edit>
			</edit>
		</open>
		<open src="includes/acp/acp_styles.php">
			<edit>
				<comment lang="en"><![CDATA[Define calendar icons for prosilver style]]></comment>
				<find>'icon_back_top', 'icon_contact_aim', 'icon_contact_email',</find>
				<inline-edit>
					<inline-find><![CDATA['icon_post_edit',]]></inline-find>
					<inline-action type="after-add"><![CDATA[ 'icon_calendar_edit_all', 'icon_calendar_delete_all',]]></inline-action>
				</inline-edit>
			</edit>
		</open>
		<open src="includes/ucp/info/ucp_main.php">
			<edit>
				<comment lang="en"><![CDATA[Define Calendar modules]]></comment>
				<find><![CDATA['subscribed'	=> array('title' => 'UCP_MAIN_SUBSCRIBED', 'auth' => '', 'cat' => array('UCP_MAIN')),
]]></find>
				<action type="after-add"><![CDATA[				'calendar_registration'		=> array('title' => 'UCP_MAIN_CALENDAR_REGISTRATION', 'auth' => '', 'cat' => array('UCP_MAIN')),
				'calendar_myevents'		=> array('title' => 'UCP_MAIN_CALENDAR_MYEVENTS', 'auth' => '', 'cat' => array('UCP_MAIN')),
]]></action>
			</edit>
		</open>
		<open src="includes/ucp/ucp_main.php">
			<edit>
				<comment lang="en"><![CDATA[Define Calendar modules actions]]></comment>
				<find><![CDATA[case 'bookmarks':]]></find>
				<action type="before-add"><![CDATA[			case 'calendar_registration':

				$user->add_lang('calendar');
				include_once($phpbb_root_path . 'includes/functions_calendar.' . $phpEx);
				$daycount = request_var('daycount', 7 );
				display_users_next_events_for_x_days($daycount, $user->data['user_id'] );
				$template->assign_vars(array(
						'U_COUNT_ACTION'	=> $this->u_action,
						'DAYCOUNT'			=> $daycount ));
			break;

			case 'calendar_myevents':

				$user->add_lang('calendar');
				include_once($phpbb_root_path . 'includes/functions_calendar.' . $phpEx);
				$daycount = request_var('daycount', 7 );
				display_posters_next_events_for_x_days($daycount, $user->data['user_id'] );
				$template->assign_vars(array(
						'U_COUNT_ACTION'	=> $this->u_action,
						'DAYCOUNT'			=> $daycount ));

			break;
]]></action>
			</edit>
		</open>
		<open src="includes/constants.php">
			<edit>
				<comment lang="en"><![CDATA[Defines Calendar Table Names]]></comment>
				<find><![CDATA[define('CALENDAR_EVENT_TYPES_TABLE',	$table_prefix . 'calendar_event_types');]]></find>
				<action type="after-add"><![CDATA[define('CALENDAR_RSVP_TABLE',		$table_prefix . 'calendar_rsvps');
define('CALENDAR_RECURRING_EVENTS_TABLE',	$table_prefix . 'calendar_recurring_events');
define('CALENDAR_EVENTS_WATCH',		$table_prefix . 'calendar_events_watch');
define('CALENDAR_WATCH',			$table_prefix . 'calendar_watch');
]]></action>
			</edit>
		</open>
		<open src="includes/functions.php">
			<edit>
				<comment lang="en"><![CDATA[Call calendar cron jobs when needed]]></comment>
				<find><![CDATA[if ($cron_type)]]></find>
						<action type="before-add"><![CDATA[		else if( populate_calendar_required() )
		{
			$cron_type = 'populate_calendar';
		}]]></action>
			</edit>
			<edit>				
				<comment lang="en"><![CDATA[Define functions that check when calendar cron jobs are needed]]></comment>
				<find><![CDATA[/**
* Closing the cache object and the database]]></find>
				<action type="before-add"><![CDATA[/**
* Do we need to populate the calendar yet?
*/
function populate_calendar_required()
{
	global $db, $sql, $config;
	$populate_calendar_freq = 0;
	$sql = 'SELECT * FROM ' . CALENDAR_CONFIG_TABLE ."
			WHERE config_name ='populate_frequency'";
	$result = $db->sql_query($sql);
	if($row = $db->sql_fetchrow($result))
	{
		$populate_calendar_freq = $row['config_value'];
	}
	$db->sql_freeresult($result);
	if( $populate_calendar_freq > 0 )
	{
		$last_calendar_populate = 0;
		$sql = 'SELECT * FROM ' . CALENDAR_CONFIG_TABLE ."
				WHERE config_name ='last_populate'";
		$result = $db->sql_query($sql);
		if($row = $db->sql_fetchrow($result))
		{
			$last_calendar_populate = $row['config_value'];
		}
		$db->sql_freeresult($result);
		if( time() - $populate_calendar_freq > $last_calendar_populate )
		{
			return true;
		}
	}
	return false;
}
]]></action>
			</edit>
		</open>
		<open src="cron.php">
			<edit>
				<comment lang="en"><![CDATA[Add auto populate event support]]></comment>
				<find><![CDATA[}

// Unloading cache and closing db after having done the dirty work.]]></find>
				<action type="before-add"><![CDATA[	case 'populate_calendar':

		include_once($phpbb_root_path . 'includes/functions_calendar.' . $phpEx);
		populate_calendar(0);

	break;
]]></action>
			</edit>
		</open>
		<open src="viewonline.php" lang="en">
			<edit>
				<comment lang="en"><![CDATA[Displays detailed info in who is online page]]></comment>
				<find><![CDATA[case 'report':
			$location = $user->lang['REPORTING_POST'];
			$location_url = append_sid("{$phpbb_root_path}index.$phpEx");
		break;
]]></find>
				<action type="after-add"><![CDATA[		case 'calendar':
		   preg_match('#view=([a-z]+)#', $row['session_page'], $on_page);
		   $calendar_mode = (!empty($on_page[1])) ? $on_page[1] : 'month'; /* if no view is defined - they are viewing the month */

		   switch ($calendar_mode)
		   {
			  case 'month':
				 $location = $user->lang['VIEWING_CALENDAR_MONTH'];
			  break;
			  case 'week':
				 $location = $user->lang['VIEWING_CALENDAR_WEEK'];
			  break;
			  case 'day':
				 $location = $user->lang['VIEWING_CALENDAR_DAY'];
			  break;
			  case 'event':
				 $location = $user->lang['VIEWING_CALENDAR_EVENT'];
			  break;
			  default:
				 $location = $user->lang['VIEWING_CALENDAR'];
			  break;
		   }
		   $location_url = append_sid("{$phpbb_root_path}".$row['session_page']);
		break;
		case 'calendarpost':
		   preg_match('#view=([a-z]+)#', $row['session_page'], $on_page);
		   $calendar_mode = (!empty($on_page[1])) ? $on_page[1] : 'post'; /* if no view is defined - they are creating a new event */

		   switch ($calendar_mode)
		   {
			  case 'edit':
				 $location = $user->lang['EDITING_CALENDAR_EVENT'];
			  break;
			  case 'post':
			  default:
				 $location = $user->lang['CREATING_CALENDAR_EVENT'];
			  break;
		   }
		   $location_url = append_sid("{$phpbb_root_path}".$row['session_page']);
		break;

]]></action>

			</edit>
		</open>			
				
		<diy-instructions lang="en"><![CDATA[To use this mod you must first execute the SQL statements.  Then upload 
all of the new and changed files from the instructions above.  Open the 
prosilver.xml file and follow those instructions to install 
the calendar user interface.  If upgrading from 0.0.8 to 0.1.0, it is assumed
that you already have the modules installed in the ACP.  However there
are numerous new permission options in 0.1.0, so you should take some time
initializing the permissions again.  For example, the old "can create events"
user level permission was replaced by "can create group events", but if you 
want users to be able to create private, or public events again, you'll have
to manually re-enable those new permission options.

Go to the "Calendar Settings" module where you can specify how far into
the future you want recurring events to be generated on the calendar.  The
default is set to 30 days, so if you create a monthly or yearly event, you will
only see the first occurrence in the calendar, unless you increase the 
"auto-populate limit".  Also if you set the populate frequency to 0, recurring
events will never get populated in the calendar.  Choose the options most appropriate
for your site.

Once you have your calendar settings, event types, and permissions set 
up you are ready to begin using the new calendar.

There are two new optional modules in the user control panel for this
mod as well.  If you want to install/enable them go to 
System -> User Control Panel.  Next to the "Add module" button is the list
of available modules.  The two modules for the calendar are under the 
"Overview [ucp_main]" group and are titled "Manage event registration"
and "Manage my events".  After enabling new modules for the UCP, you must
purge your cache before they will appear.

]]>
</diy-instructions>
	</action-group>
</mod>
