<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
	<!-- Raidplanner $Id $ -->
	<!--
		For security purposes, please check: http ://www.phpbb.com/mods/ for
		the latest version of this MOD. Although MODs are checked before being
		allowed in the MODs Database there is no guarantee that there are no
		security problems within the MOD. No support will be given for MODs
		not found within the MODs Database which can be found at
		http://www.phpbb.com/mods/
	-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.5.xsd">
	<header>
		<license>http://opensource.org/licenses/gpl-license.php
			GNU General Public License v2</license>
		<title lang="en-gb">RaidPlanner 0.0.1</title>
		<description lang="en-gb">Raidplanner Installer.
			The Raidplanner mod is based on Alightner's Calendar mod, and modified
			to work with bbDKP. It has an UMIL installer, Raid icons and links to
			the bbDKP event and members Table. If you have no bbDKP installation
			it can be used as a standalone Calendar.</description>
		<author-notes lang="en-gb">We hope you get everything working.
			further developement requests, support questions are welcome at
			www.bbdkp.com</author-notes>
		<author-group>
			<author>
				<realname>A. Vandenberghe</realname>
				<email>sajaki9@gmail.com</email>
				<username>Sajaki</username>
				<homepage>http://www.bbdkp.com</homepage>
				<contributions-group>
					<contributions status="current" from="2010-09-30"
						position="Developer" />
				</contributions-group>
			</author>
			<author>
				<realname><![CDATA[E. Ford]]></realname>
				<username><![CDATA[alightner]]></username>
				<homepage><![CDATA[http://www.phpbbcalendarmod.com]]></homepage>
				<contributions-group>
					<contributions status="current" from="2007-09-07"
						position="Developer" />
				</contributions-group>
			</author>
			<author>
				<realname><![CDATA[T. Farmer]]></realname>
				<username><![CDATA[SpaceDoG]]></username>
				<contributions-group>
					<contributions status="past" from="2007-09-06" to="2007-10-29"
						position="Developer" />
				</contributions-group>
			</author>
		</author-group>
		<mod-version>0.0.1</mod-version>
		<installation>
			<level>easy</level>
			<time>300</time>
			<target-version>3.0.8</target-version>
		</installation>
		<history>
			<entry>
				<date>2010-12-01</date>
				<rev-version>0.0.1</rev-version>
				<changelog lang="en">
					<change>[CHG] split backend /includes code and refactored into
						classes</change>
					<change>[CHG] added UMIF installer script, removed sql portions from modx, changed tablenames</change>
					<change>[CHG] split modx file into main and language</change>
					<change>[CHG] new constants file</change>
					<change>[CHG] mod renamed and version number back to 0.0.1
					</change>
				</changelog>
			</entry>
		</history>
		<meta name="generator" content="Phpbb.ModTeam.Tools (c#)" />
	    <link-group>
	       <link type="language" lang="en" href="contrib/en.xml">English</link>
	    </link-group>
	</header>
	<action-group>
		<copy>
			<file from="root/*.*" to="*.*" />
		</copy>

		<open src="common.php">
			<edit>
				<comment lang="en"><![CDATA[adding required classfiles for Raidplanner in common.php.]]></comment>
				<comment lang="fr"><![CDATA[Ajout des classes requises Raidplanner dans common.php]]></comment>
				<comment lang="de"><![CDATA[ZufÃ¼gung Raidplanner im common.php]]></comment>
				<find><![CDATA[require($phpbb_root_path . 'includes/constants.' . $phpEx);]]></find>
				<action type="after-add"><![CDATA[// Raidplanner
require($phpbb_root_path .  'includes/bbdkp/raidplanner/constants_rp.' . $phpEx);
]]></action>
			</edit>
		</open>
		<!--
			will be replaced with new (localized) images hook in 3.1
			http://area51.phpbb.com/phpBB/viewtopic.php?f=111&t=33738
		-->
		<open src="includes/acp/acp_language.php">
			<edit>
				<comment lang="en"><![CDATA[Define raidplanner imageset keys for localised theme language]]></comment>
				<find><![CDATA['icon_back_top', 'icon_contact_aim', 'icon_contact_email',]]></find>
				<inline-edit>
					<inline-find><![CDATA['icon_post_edit',]]></inline-find>
					<inline-action type="after-add"><![CDATA[ 'icon_raidplanner_edit_all', 'icon_raidplanner_delete_all','button_raidplanner_new', 'button_raidplanner_day', 'button_raidplanner_week', 'button_raidplanner_month',]]></inline-action>
				</inline-edit>
			</edit>
		</open>

		<open src="includes/acp/acp_styles.php">
			<edit>
				<comment lang="en"><![CDATA[Define new localised raidplanner imageset keys for theme ]]></comment>
				<find><![CDATA['icon_back_top', 'icon_contact_aim', 'icon_contact_email',]]></find>
				<inline-edit>
					<inline-find><![CDATA['icon_post_edit',]]></inline-find>
					<inline-action type="after-add"><![CDATA[ 'button_raidplanner_new', 'button_raidplanner_day', 'button_raidplanner_week', 'button_raidplanner_month',]]></inline-action>
				</inline-edit>
			</edit>
		</open>

		<open src="includes/ucp/ucp_main.php">
			<edit>
				<comment lang="en"><![CDATA[Define Calendar modules actions]]></comment>
				<find><![CDATA[case 'bookmarks':]]></find>
				<action type="before-add"><![CDATA[			case 'raidplanner_registration':

				$user->add_lang('mods/raidplanner');
				if ( !class_exists('displayplanner')) 
		        {
					include($phpbb_root_path . 'includes/bbdkp/raidplanner/raidplanner_display.' . $phpEx);
		        }
		        $cal = new displayplanner;
				$daycount = request_var('daycount', 7 );
				$cal->display_users_next_events_for_x_days($daycount, $user->data['user_id'] );
				$template->assign_vars(array(
						'U_COUNT_ACTION'	=> $this->u_action,
						'DAYCOUNT'			=> $daycount ));
				unset($cal); 
			break;

			case 'raidplanner_myevents':

				$user->add_lang('mods/raidplanner');
				if ( !class_exists('displayplanner')) 
		        {
					include($phpbb_root_path . 'includes/bbdkp/raidplanner/raidplanner_display.' . $phpEx);
				}
				$cal = new displayplanner;
				$daycount = request_var('daycount', 7 );
				$cal->display_posters_next_events_for_x_days($daycount, $user->data['user_id'] );
				$template->assign_vars(array(
						'U_COUNT_ACTION'	=> $this->u_action,
						'DAYCOUNT'			=> $daycount ));
				unset($cal);

			break;
]]></action>
			</edit>
		</open>
		
		<open src="includes/ucp/info/ucp_main.php">
			<edit>
				<comment lang="en"><![CDATA[Define Raidplanner submodules in UCP]]></comment>
				<find><![CDATA['subscribed'	=> array('title' => 'UCP_MAIN_SUBSCRIBED', 'auth' => '', 'cat' => array('UCP_MAIN')),
				]]></find>
				<action type="after-add"><![CDATA[				'raidplanner_registration'		=> array('title' => 'UCP_MAIN_RAIDPLANNER_REGISTRATION', 'auth' => '', 'cat' => array('UCP_MAIN')),
				'raidplanner_myevents'		=> array('title' => 'UCP_MAIN_RAIDPLANNER_MYEVENTS', 'auth' => '', 'cat' => array('UCP_MAIN')),
				]]></action>
			</edit>
		</open>

		<php-installer><![CDATA[install/installrp.php]]></php-installer>
		<diy-instructions lang="en">Run database installer : Browse to install/installrp.php</diy-instructions>
	</action-group>
</mod>
